buildvariants:
  - display_name: Ubuntu 18.04
    name: ubuntu1804
    run_on:
      - ubuntu1804-test
    tasks:
      - name: build
      - name: unit_tests
      - name: lint
      - name: format

bonsai:
  - source: github
    owner: dbradf
    repo: evg-bonsai-rust

pre:
  - command: git.get_project
    params:
      directory: src
  - bonsai: cargo:install rust
    params:
      rust_version: stable
  - bonsai: cargo:enable nextest

post:
  - command: attach.xunit_results
    params:
      file: src/target/nextest/ci/*_junit.xml

tasks:
  - name: unit_tests
    commands:
    - bonsai: cargo:run
      params:
        target_dir: src
        cargo_command: nextest run --profile ci

  - name: format
    commands:
    - bonsai: cargo:run
      params:
        target_dir: src
        cargo_command: fmt --check

  - name: lint
    commands:
    - bonsai: cargo:run
      params:
        target_dir: src
        cargo_command: clippy

  - name: build
    commands:
    - bonsai: cargo:run
      params:
        target_dir: src
        cargo_command: build

